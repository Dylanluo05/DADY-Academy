<!DOCTYPE html>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300&display=swap" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    </head>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            color: white;
            background-color: #160E2C;
            font-family: 'Raleway', sans-serif;
            overflow-x: hidden;
        }

        h1 {
            font-size: 70px;
            font-weight: lighter;
            color: white;
            transition-duration: 0.4s;
        }

        * {
            box-sizing: border-box;
        }

        #physics-background-1 {
            position: relative;
            background-repeat: no-repeat;
        }

        .physics-background-1-image, .physics-background-1-overlay {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        .physics-background-1-image {
            height: 650px;
            background: url("https://images.pexels.com/photos/8472938/pexels-photo-8472938.jpeg?auto=compress&cs=tinysrgb&w=800");
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .physics-background-1-overlay {
            height: 650px;
            background-color: black;
            opacity: 0.7;
            z-index: 2;
        }

        .physics-background-1-content {
            height: 650px;
            position: relative;
            z-index: 3;
        }

        #physics-background-2 {
            position: relative;
            background-repeat: no-repeat;
        }

        .physics-background-2-image, .physics-background-2-overlay {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }

        .physics-background-2-image {
            height: 850px;
            background: url("https://images.pexels.com/photos/6208704/pexels-photo-6208704.jpeg?auto=compress&cs=tinysrgb&w=600");
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            z-index: 1;
        }

        .physics-background-2-overlay {
            height: 850px;
            background-color: #282828;
            opacity: 0.7;
            z-index: 2;
        }

        .physics-background-2-content {
            height: 850px;
            position: relative;
            z-index: 3;
        }

        .physics-transition-background {
            height: 200px;
            background-color: crimson;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #kinematics-form {
            padding: 20px;
            width: 800px;
            background-color: white;
            display: block;
            margin: auto;
            margin-top: 100px;
            box-shadow: 0 10px 10px 0 rgba(255, 255, 255, 0.7);
        }
        
        label {
            color: black;
            display: block;
            text-align: center;
        }

        p {
            display: inline;
            color: black;
        }

        .kinematics-input {
            display: block;
            margin: auto;
        }

        #kinematics-button {
            height: 30px;
            width: 250px;
            background-color: white;
            border: 2px solid crimson;
            color: crimson;
            display: block;
            margin: auto;
            margin-top: 10px;
            transition-duration: 0.7s;
        }

        #kinematics-button:hover {
            background-color: crimson;
            color: white;
        }




        .objectcards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            align-content: center;
        }

        .objectcard {
            width: 200px;
            height: 200px;
            margin: 10px;
            padding: 2em;
            border: 1px solid white;
            border-radius: 10px;
            background-image: linear-gradient(to right, purple, navy);
            text-align: center;
        }

        table .objectcard {
            width: 100%;
            margin: 0;
            padding: 0;
            border: 0;
            border-radius: 0;
            background-color: #f1f1f1;
            text-align: center;
        }

        .objectcardbutton {
            background-color: white;
            color: black;
            border: 1px solid white;
            margin: 0.5em;
            padding: 0.75em;
            background-image: none;
        }
        .objectcardbutton:hover {
            border: 1px solid white;
            background-color: #e5e5e5;
        }

        .selectedobjectcardbutton {
            border: 1px solid white;
            margin: 0.5em;
            padding: 0.75em;
            background-image: none;
            background-color: #778899;
            color: white;
            cursor: default;
        }

        .maincard {
            width: 95%;
            margin: 10px;
            padding: 2em;
            border: 1px solid white;
            border-radius: 10px;
            background-image: linear-gradient(to right, purple, navy);
        }

        .createcard {
            width: 95%;
            margin: 10px;
            padding: 2em;
            border: 1px solid white;
            border-radius: 10px;
            background-image: linear-gradient(to right, red, purple);
        }

        .maintitle{
            color: white;
        }

        input[type=text] {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        box-sizing: border-box;
        border: 1px solid white;
        border-radius: 4px;
        background-color: black;
        color: white;
        }
        input[type=text]:focus {
        border: 1px solid white;
        }

        hr.cardhr {
            height:2px;
            border-width:0;
            color:white;
            background-color:white
        }

    </style>
    <body>
        <div id = "physics-background-1">
            <div class = "physics-background-1-image"></div>
            <div class = "physics-background-1-overlay"></div>
            <div class = "physics-background-1-content">
                <div id = "navbar-content"></div>
                <h1 style = "text-align: center; font-size: 120px; margin-top: 30px;">Physics</h1>
                <h2 style = "text-align: center; font-size: 30px; font-weight: lighter; margin-top: -30px;">Discover why the matter of this world behaves the way it does</h2>
                <div style = "width: 700px; display: block; margin: auto; margin-top: 70px;">
                    <h2 style = "font-size: 21px; font-weight: lighter; text-align: center;">Physics is the study of matter and energy, their fundamental constituents, and their movement and behavior through space and time.</h2>
                </div>
            </div>
        </div>
        <div class = "physics-transition-background">
            <h1>Mechanics</h1>
        </div>
        <div id = "physics-background-2">
            <div class = "physics-background-2-image"></div>
            <div class = "physics-background-2-overlay"></div>
            <div class = "physics-background-2-content">
                <h2 style = "margin: 0; position: relative; top: 50px; text-align: center; font-size: 50px; font-weight: lighter;">Kinematics</h2>
                <form id = "kinematics-form">
                    <label for = "known-values">Which values are known?</label>  
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "checkbox" name = "known-values" value = "initial-velocity"><p>Initial Velocity</p> 
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "checkbox" name = "known-values" value = "final-velocity"><p>Final Velocity</p>
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "checkbox" name = "known-values" value = "acceleration"><p>Acceleration</p>
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "checkbox" name = "known-values" value = "displacement"><p>Displacement</p>
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "checkbox" name = "known-values" value = "time"><p>Time</p>
                    </div>
                    <label for = "initial-velocity-value">What is the value of the initial velocity (If known, otherwise leave blank)</label>
                    <input type = "text" name = "initial-velocity-value" class = "kinematics-input">
                    <label for = "final-velocity-value">What is the value of the final velocity (If known, otherwise leave blank)</label>
                    <input type = "text" name = "final-velocity-value" class = "kinematics-input">
                    <label for = "acceleration-value">What is the value of the acceleration (If known, otherwise leave blank)</label>
                    <input type = "text" name = "acceleration-value" class = "kinematics-input">
                    <label for = "displacement-value">What is the value of the displacement (If known, otherwise leave blank)</label>
                    <input type = "text" name = "displacement-value" class = "kinematics-input">
                    <label for = "time-value">What is the value of the time (If known, otherwise leave blank)</label>
                    <input type = "text" name = "time-value" class = "kinematics-input">
                    <label for = "unknown-value">What is the value you want to find?</label>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "radio" name = "unknown-value" value = "initial-velocity"><p>Initial Velocity</p> 
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "radio" name = "unknown-value" value = "final-velocity"><p>Final Velocity</p>
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "radio" name = "unknown-value" value = "acceleration"><p>Acceleration</p>
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "radio" name = "unknown-value" value = "displacement"><p>Displacement</p>
                    </div>
                    <div style = "width: 150px; display: block; margin: auto;">
                        <input type = "radio" name = "unknown-value" value = "time"><p>Time</p>
                    </div>
                    <input type = "submit" id = "kinematics-button" value = "Calculate">
                </form>

                <div class="objectcards">
                    <div class="maincard">
                        <h1 class="maintitle" id="mainTitle">No Currently Selected Object</h1>
                        <h3 class="maintitle" id="mainMass"></h3>
                        <h3 class="maintitle" id="mainRecKE"></h3>
                        <h3 class="maintitle" id="mainRecPE"></h3>
                        <hr class="cardhr">
                        <h3 class="maintitle"> Calculate KE </h3>
                        <div style="white-space: nowrap;">
                            <input placeholder="Velocity (v) value" style="width:65%; display: inline-block;" type="text" id="velocity-input" name="Velocity">
                            <button id="calcKEbutton" style="width:33%; display: inline-block;" class="objectcardbutton"> Calculate </button>
                        </div>
                        <br>
                        <h3 class="maintitle"> Calculate PE </h3>
                        <div style="white-space: nowrap;">
                            <input placeholder="Gravity (g) value" style="width:32%; display: inline-block;" type="text" id="gravity-input" name="Gravity">
                            <input placeholder="Height (h) value" style="width:32%; display: inline-block;" type="text" id="height-input" name="Height">
                            <button id="calcPEbutton" style="width:33%; display: inline-block;" class="objectcardbutton"> Calculate </button>
                        </div>
                        <br>
                        <button id="historybutton" class="objectcardbutton" onclick="toggleHistory()"> Show History </button>
                        <div id="history" style="display: none;">
                            <table id="histable">
                            </table>
                            <button style="border: 1px solid red; background-color: red; display: none;" id="clearhistorybutton" class="objectcardbutton" onclick="scrubHistory()"> Clear History </button>
                        </div>
                    </div>
                </div>
                <br>
                    
                <div class="objectcards" id="cardholder">
                </div>
                <br>
                    
                    
                <div class="objectcards">
                    <div class="createcard">
                        <h1 class="maintitle">Create an object</h1>
                        <div style="white-space: nowrap;">
                            <input placeholder="Mass (m) value" style="width:65%; display: inline-block;" type="text" id="mass-input" name="Object Mass">
                            <button id="createbutton" style="width:33%; display: inline-block;" class="objectcardbutton" onclick="createObj();"> Create  </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(function(){
                $("#navbar-content").load("/layouts/navbar.html");
            });

            var url = "https://frq.dtsivkovski.tk/api/physics/get/";
            const options = {
                method: 'GET', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'default', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'include', // include, *same-origin, omit
                headers: {
                    'Content-Type': 'application/json',
                },
            };

            var storedinfo;
            var cardholder = document.getElementById("cardholder");
            var mTitle = document.getElementById("mainTitle");
            var mMass = document.getElementById("mainMass");
            var mRecKE = document.getElementById("mainRecKE");
            var mRecPE = document.getElementById("mainRecPE");
            var calcKEbutton = document.getElementById("calcKEbutton");
            var calcPEbutton = document.getElementById("calcPEbutton");
            var historybutton = document.getElementById("historybutton");
            var history = document.getElementById("history");
            var histable = document.getElementById("histable");

            function getAllObjects() {
            // fetch the API
                fetch(url, options)
                // response is a RESTful "promise" on any successful fetch
                .then(response => {
                    // check for response errors and display
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        const tr = document.createElement("tr");
                        const td = document.createElement("td");
                        td.innerHTML = errorMsg;
                        tr.appendChild(td);
                        cardholder.appendChild(tr);
                        return;
                    }
                    // valid response will contain json data
                    response.json().then(data => {
                        console.log(data);

                        //remove existing cardholder
                        while(cardholder.firstChild) {
                            cardholder.removeChild(cardholder.firstChild);
                        }

                        for (const row of data) {
                            // create card and give classlist, add to cardholder
                            const card = document.createElement("div");
                            card.classList.add("objectcard");
                            cardholder.appendChild(card);

                            // create elements for card
                            const h3 = document.createElement("h3");
                            h3.innerHTML = "Object #" + row.id;
                            const mass = document.createElement("p");
                            mass.innerHTML = "Mass: " + row.mass + "kg";
                            const recKE = document.createElement("p");
                            recKE.innerHTML = "Recent KE Calc: " + row.recentKE;
                            const recPE = document.createElement("p");
                            recPE.innerHTML = "Recent PE Calc: " + row.recentPE;

                            card.appendChild(h3);
                            card.appendChild(mass);
                            card.appendChild(recKE);
                            card.appendChild(recPE);
                            
                            const buttonholder = document.createElement("div");
                            buttonholder.style.whiteSpace = "nowrap";

                            // create button and give classlist, add to card
                            const button = document.createElement("button");
                            button.classList.add("objectcardbutton");
                            button.style.width = "40%";
                            button.style.display = "inline-block";
                            button.innerHTML = "Select";
                            button.id = "objbutton" + row.id;
                            button.addEventListener("click", function() {
                                selectObj(row.id);
                            });
                            card.appendChild(button);

                            // add deletebutton and give classlist
                            const deletebutton = document.createElement("button");
                            deletebutton.classList.add("objectcardbutton");
                            deletebutton.innerHTML = "Delete";
                            deletebutton.style.backgroundColor = "red";
                            deletebutton.style.border = "1px solid red";
                            deletebutton.style.width = "40%";
                            deletebutton.style.display = "inline-block";
                            deletebutton.addEventListener("click", function() {
                                deleteObj(row.id);
                            });
                            card.appendChild(deletebutton);
                        }

                        storedinfo = data;
                    });
                })
            }

            getAllObjects();

            var selectedObj;

            function selectObj(id) {
                console.log("Selected Object - Id: " + id);

                // turn on history delete button when selected obj for first time
                document.getElementById("clearhistorybutton").style.display = "block";

                // remove selected class from button with selectedObj id
                if (selectedObj != null) {
                    var tempOB = document.getElementById("objbutton" + selectedObj);
                    tempOB.innerHTML = "Select";
                    tempOB.classList.remove("selectedobjectcardbutton");
                    tempOB.classList.add("objectcardbutton");
                }

                // set innerHTML to selected object values using storedinfo
                for (const row of storedinfo) {
                    if (row.id == id) {
                        mTitle.innerHTML = "Object #" + row.id;
                        mMass.innerHTML = "Mass: " + row.mass + "kg";
                        mRecKE.innerHTML = "Recent KE Calc: " + row.recentKE;
                        mRecPE.innerHTML = "Recent PE Calc: " + row.recentPE;

                        var tempOB = document.getElementById("objbutton" + row.id);
                        tempOB.innerHTML = "Selected";
                        tempOB.classList.add("selectedobjectcardbutton");
                        tempOB.classList.remove("objectcardbutton");
                        selectedObj = row.id;

                        // remove old event listener and add new one
                        calcKEbutton.onclick = function() {
                            calcKE(row.id);
                        };

                        calcPEbutton.onclick = function() {
                            calcPE(row.id);
                        };

                        while (histable.firstChild) {
                            histable.removeChild(histable.firstChild);
                        }
                        const th1 = document.createElement("th");
                        const th2 = document.createElement("th");
                        th1.innerHTML = "Calculation";
                        th2.innerHTML = "Result";
                        histable.appendChild(th1);
                        histable.appendChild(th2);

                        for (const [key,value] of Object.entries(row.history)) {
                            // console.log(key + " : " + value);

                            var tr = document.createElement("tr");
                            var tdkey = document.createElement("td");
                            var tdvalue = document.createElement("td");

                            tdkey.innerHTML = key;
                            tdvalue.innerHTML = value;
                            tr.appendChild(tdkey);
                            tr.appendChild(tdvalue);
                            histable.appendChild(tr);
                        }



                    }
                }
            }

            function calcKE(id) {
                console.log("Calculating KE for Object - Id: " + id);

                // build url for fetch
                var calcKEurl = "https://frq.dtsivkovski.tk/api/physics/calculateKE/" + id + "/" + document.getElementById("velocity-input").value;

                fetch(calcKEurl, options)
                // response is a RESTful "promise" on any successful fetch
                .then(response => {
                    // check for response errors and display
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        return;
                    }
                    // valid response will contain json data
                    response.json().then(data => {
                        console.log(data);
                        mRecKE.innerHTML = "Recent KE Calc: " + data.recentKE;
                        getAllObjects();

                        // add new row to history table
                        var tr = document.createElement("tr");
                        var tdkey = document.createElement("td");
                        var tdvalue = document.createElement("td");

                        tdkey.innerHTML = "KE (v = " + document.getElementById("velocity-input").value + ")";
                        tdvalue.innerHTML = data.recentKE;

                        tr.appendChild(tdkey);
                        tr.appendChild(tdvalue);
                        histable.appendChild(tr);


                        });
                });
            }

            function calcPE(id) {
                console.log("Calculating PE for Object - Id: " + id);

                // build url for fetch
                var calcPEurl = "https://frq.dtsivkovski.tk/api/physics/calculatePE/" + id + "/" + document.getElementById("gravity-input").value + "/" + document.getElementById("height-input").value;

                fetch(calcPEurl, options)
                // response is a RESTful "promise" on any successful fetch
                .then(response => {
                    // check for response errors and display
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        return;
                    }
                    // valid response will contain json data
                    response.json().then(data => {
                        console.log(data);
                        mRecPE.innerHTML = "Recent PE Calc: " + data.recentPE;
                        getAllObjects();

                        var tr = document.createElement("tr");
                        var tdkey = document.createElement("td");
                        var tdvalue = document.createElement("td");

                        tdkey.innerHTML = "PE (g = " + document.getElementById("gravity-input").value + ", h = " + document.getElementById("height-input").value + ")";
                        tdvalue.innerHTML = data.recentPE;

                        tr.appendChild(tdkey);
                        tr.appendChild(tdvalue);
                        histable.appendChild(tr);


                        });
                });
            }

            function createObj() {
                console.log("Creating Object");

                // build url for fetch
                var createObjurl = "https://frq.dtsivkovski.tk/api/physics/create/" + document.getElementById("mass-input").value;

                fetch(createObjurl, options)
                // response is a RESTful "promise" on any successful fetch
                .then(response => {
                    // check for response errors and display
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        return;
                    }
                    // valid response will contain json data
                    response.json().then(data => {
                        console.log(data);

                        getAllObjects();
                        selectObj(data.id);
                        });
                });
            }

            function deleteObj(id) {

                if (confirm("Are you sure you want to delete this object?") == false)
                    return;

                console.log("Deleting Object - Id: " + id);

                // build url for fetch
                var deleteObjurl = "https://frq.dtsivkovski.tk/api/physics/delete/" + id;

                fetch(deleteObjurl, options)
                // response is a RESTful "promise" on any successful fetch
                .then(response => {
                    // check for response errors and display
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        return;
                    }
                    // valid response will contain json data
                    response.json().then(data => {
                        console.log(data);

                        getAllObjects();
                        selectObj(data[0].id);
                        });
                });
            }

            function toggleHistory() {
                if (history.style.display == "none") {
                    history.style.display = "block";
                    historybutton.innerHTML = "Hide History";
                } else {
                    history.style.display = "none";
                    historybutton.innerHTML = "Show History";
                }
            }

            function scrubHistory() {
                if (confirm("Are you sure you want to delete all of this object's history?") == false)
                    return;

                console.log("Deleting History - Id: " + selectedObj);

                // build url for fetch
                var scrubHistoryurl = "https://frq.dtsivkovski.tk/api/physics/scrub/" + selectedObj;

                fetch(scrubHistoryurl, options)
                // response is a RESTful "promise" on any successful fetch
                .then(response => {
                    // check for response errors and display
                    if (response.status !== 200) {
                        const errorMsg = 'Database response error: ' + response.status;
                        console.log(errorMsg);
                        return;
                    }
                    // valid response will contain json data
                    response.json().then(data => {
                        console.log(data);

                        getAllObjects();
                        selectObj(data.id);

                        while (histable.firstChild) {
                            histable.removeChild(histable.firstChild);
                        }

                        mRecKE.innerHTML = "Recent KE Calc: 0";
                        mRecPE.innerHTML = "Recent PE Calc: 0";

                        });
                });
            }
        </script>
    </body>
</html>